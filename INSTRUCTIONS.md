## Steps to get the squid processor running for Laguna Chain
1. Most importantly, you need the Laguna Chain to be running to index it in the first place. So, spin up a Laguna node by navigating to the root folder of the Laguna Chain repo, compile the node and run it:
* compilation: `cargo build --release'
* running the actual node: `./target/release/laguna-node --tmp --dev`
2. Once you get the chain running, make note of the port it is running on-- by default it is 9944.
3. Expose the RPC url (default: localhost:9944) of the chain to the public to allow access to our chain publicly. For this you need to download a tool like ngrok. Once you have ngrok downloaded on your machine, run: `./ngrok http <CHAIN_PORT_NUMBER> (default: 9944). It returns a an url like `http://<RPC_URL>`

### Setting up the Archive
4. Set the RPC endpoint in the `archive/docker-compose.yml` by replacing the existing endpoint (set to kusama by default in the subsquid-template) with `wss://<RPC_URL>`. Additionally, if you require support to index wasm-contracts, enable it in the `docker-compose.yml (under the gateway key)`. Run the archive: `docker compose -f archive/docker-compose.yml up`. The archive exposes the graphql endpoint on the port `8888` by default. 

### Install Dependencies
* Requisites: Node.js (16 or later), Docker
* Install core dependencies from the root folder: `npm install && npm update`
* Install additional dependencies (needed for wasm-indexing): `npm install @subsquid/ink-abi @subsquid/ink-typegen`

### Setting up the Processor
* Once the archive is running, we can set up the processor. First step would be to define the schema of the events you want to index in the `schema.graphql` file. 
* Change the archive source url in the `processor.ts` to point to our local Laguna Chain graphql endpoint, which by default by `http://localhost:8888/graphql`. 
* Add all the events you want to index by adding them to the `SubstrateBatchProcessor` using the method `addEvent()`. For example, if you want to fetch the Transfer events emitted by pallet-balances (generated as `Balances` by construct_runtime!() macro). 
```Batchfile
const processor = new SubstrateBatchProcessor()
    .setDataSource({
        archive: "http://localhost:8888/graphql"
    }).
    addEvent("Balances.Transfer", {
        data: {event: {args: true}}, 
    } as const)
```
* To support wasm-based ink contract indexing, you first need to generate typegen (this will be needed to decode events / messages of a contract fetched by the substrateprocessor) for the contract abi. For example, if you want to index ERC20 ink contracts, save the ERC20 abi file generated by the compiler at the path `src/abi/erc20.json` and run:     
    `npx squid-ink-typegen --abi src/abi/erc20.json --output src/abi/erc20.ts` 
* All the processor logic concerned with building up the event database goes in the `processor.run(new TypeormDatabase(), async ctx => { /* LOGIC GOES HERE*/})`